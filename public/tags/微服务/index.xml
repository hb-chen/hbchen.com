<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>å¾®æœåŠ¡ on Hobo&#39;s Blog - åœ¨è·¯ä¸Š~æ°¸ä¸åœæ­¢çš„è„šæ­¥</title>
    <link>http://hbchen.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/</link>
    <description>Recent content in å¾®æœåŠ¡ on Hobo&#39;s Blog - åœ¨è·¯ä¸Š~æ°¸ä¸åœæ­¢çš„è„šæ­¥</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en</language>
    <copyright>HB Studio</copyright>
    <lastBuildDate>Tue, 05 Mar 2019 20:44:07 +0800</lastBuildDate>
    
        <atom:link href="http://hbchen.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>å¦‚ä½•è‡ªå®šä¹‰Istio Mixer Adapter</title>
      <link>http://hbchen.com/post/2019-03-05-custom-istio-mixer-adapter/</link>
      <pubDate>Tue, 05 Mar 2019 20:44:07 +0800</pubDate>
      
      <guid>http://hbchen.com/post/2019-03-05-custom-istio-mixer-adapter/</guid>
      
        <description>&lt;blockquote&gt;
&lt;p&gt;å¿«é€Ÿå¼€å§‹:&lt;a href=&#34;https://github.com/hb-go/micro-mesh/tree/master/examples/adapter/auth&#34;&gt;micro-mesh/examples/adapter/auth&lt;/a&gt;æºç ä¼ é€é—¨&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;ç ”ç©¶Istioä¸‹æ„å»ºç®€æ´çš„å¾®æœåŠ¡æ¶æ„ï¼Œå¯¹Istioçš„ç ”ç©¶ä¹Ÿæ›´æ·±å…¥ï¼Œè‡ªå®šä¹‰Mixer Adapterå¿…ä¸å°‘ï¼Œä»¥ä¸‹ç»“åˆä½¿ç”¨åœºæ™¯åšä¸€ä¸ªè‡ªå®šä¹‰Adapterçš„å®è·µåˆ†äº«ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;h2 id=&#34;èƒŒæ™¯&#34;&gt;èƒŒæ™¯&lt;/h2&gt;

&lt;p&gt;ç»“åˆ&lt;a href=&#34;https://github.com/hb-go/micro-mesh&#34;&gt;micro-mesh&lt;/a&gt;çš„å®è·µåœºæ™¯ï¼Œéœ€è¦åœ¨&lt;code&gt;ingressgateway&lt;/code&gt;ä¸&lt;code&gt;API service&lt;/code&gt;é—´åŠ å…¥è®¤è¯&amp;amp;é‰´æƒ(JWT&amp;amp;RBAC)ï¼Œè‡ªç„¶è€ƒè™‘Istioæä¾›çš„&lt;a href=&#34;https://istio.io/zh/docs/concepts/security/&#34;&gt;å®‰å…¨&lt;/a&gt;æ–¹æ¡ˆï¼Œä½†ä½¿ç”¨JWTåšè®¤è¯é‰´æƒåœ¨åç«¯æ˜¯æ— çŠ¶æ€çš„ï¼Œè¿™æ ·åœ¨ä½¿ç”¨åœºæ™¯ä¸Šæœ‰ä¸€å®šé™åˆ¶ï¼Œå¦‚:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å¯†ç ä¿®æ”¹ã€ç»ˆç«¯è¿æ¥é™åˆ¶ç­‰åœºæ™¯ä¸‹æ— æ³•è¸¢é™¤&lt;/li&gt;
&lt;li&gt;è®¿é—®æ§åˆ¶ç­–ç•¥æ— æ³•å®æ—¶ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
&lt;p&gt;é»˜è®¤æ–¹æ¡ˆåªæ˜¯åœ¨ä¸€äº›åœºæ™¯ä¸‹ä¸åˆé€‚ï¼Œæ ¹æ®å…·ä½“éœ€æ±‚è€ƒè™‘&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;åŸºäºè¿™æ ·çš„åœºæ™¯å¯ä»¥è‡ªå®šä¹‰Adapteræ¥å®ç°ï¼Œç›®æ ‡:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Token-JWT

&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯éªŒè¯tokenæœ‰æ•ˆæ€§&lt;/li&gt;
&lt;li&gt;åº”å¯¹å¯†ç ä¿®æ”¹ã€ç»ˆç«¯æ•°é‡é™åˆ¶ç­‰åœºæ™¯&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;ACL-&lt;a href=&#34;http://github.com/casbin/casbin&#34;&gt;Casbin&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;æœåŠ¡ç«¯è·å–ç”¨æˆ·è§’è‰²ï¼ŒåšAPIè®¿é—®æ§åˆ¶&lt;/li&gt;
&lt;li&gt;ç”¨æˆ·è§’è‰²åŠæ¥å£æˆæƒç­–ç•¥å®æ—¶ç”Ÿæ•ˆ
&lt;br /&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;ä»¥ä¸‹ç¤ºä¾‹å¯¹tokenéªŒè¯ã€è®¿é—®æ§åˆ¶ä¸åšå…·ä½“è®¾è®¡ï¼Œé‡ç‚¹ä»‹ç»å¦‚ä½•è‡ªå®šä¹‰ä¸€ä¸ª&lt;code&gt;auth-adapter&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&#34;è‡ªå®šä¹‰adapterä»‹ç»&#34;&gt;è‡ªå®šä¹‰Adapterä»‹ç»&lt;/h2&gt;

&lt;p&gt;é…ç½®å…³ç³»åŠæ‰§è¡Œæµç¨‹å¦‚å›¾ï¼š
&lt;img src=&#34;http://hbchen.com/img/auth-adapter.jpg&#34; alt=&#34;auth-adapter&#34; /&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;å±æ€§ï¼šä½¿ç”¨&lt;code&gt;istio&lt;/code&gt;çš„&lt;code&gt;attributes&lt;/code&gt;ï¼Œ&lt;code&gt;istio/mixer/testdata/config/attributes.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ˜ å°„æ¨¡æ¿ï¼šä½¿ç”¨&lt;code&gt;istio&lt;/code&gt;çš„&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿ï¼Œ&lt;code&gt;istio/mixer/template/authorization/template.yaml&lt;/code&gt;ï¼Œé€šè¿‡&lt;code&gt;template.proto&lt;/code&gt;æŸ¥çœ‹åè®®å†…å®¹&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/config/auth-adapter.yaml&lt;/code&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;go generate ./...&lt;/code&gt;è‡ªåŠ¨ç”Ÿæˆ&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/config/config.proto&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å®ä¾‹ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/operatorconfig/cluster-service.yaml&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨é…ç½®ï¼Œ&lt;code&gt;micro-mesh/examples/adapter/auth/operatorconfig/operator-cfg.yaml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&#34;ç›®å½•ç»“æ„&#34;&gt;ç›®å½•ç»“æ„&lt;/h5&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;bin                         æ‰§è¡Œæ–‡ä»¶
cmd                         
  â”” main.go                 é€‚é…å™¨å…¥å£
config                      é…ç½®åè®®
  â”œ adapter.auth.config.pb.html                 #go generate ./... è‡ªåŠ¨ç”Ÿæˆ
  â”œ auth-adapter.yaml       é€‚é…å™¨æè¿°æ–‡ä»¶       #go generate ./... è‡ªåŠ¨ç”Ÿæˆ
  â”œ config.pb.go                                #go generate ./... è‡ªåŠ¨ç”Ÿæˆ
  â”œ config.proto            é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®
  â”” config.proto_descriptor                     #go generate ./... è‡ªåŠ¨ç”Ÿæˆ
operatorconfig              k8sé…ç½®
  â”œ attributes.yaml         å±æ€§                  #copy istio/mixer/testdata/config/attributes.yaml
  â”œ cluster-service.yaml    é€‚é…å™¨æœåŠ¡å®ä¾‹
  â”œ operator-cfg.yaml       é€‚é…å™¨é…ç½®
  â”” template.yaml           å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ¨¡æ¿    #copy istio/mixer/template/authorization/template.yaml
testdata                    æµ‹è¯•é…ç½®
  â”œ attributes.yaml         å±æ€§                  #copy istio/mixer/testdata/config/attributes.yaml
  â”œ auth-adapter.yaml       é€‚é…å™¨æè¿°æ–‡ä»¶         #copy config/auth-adapter.yaml
  â”œ operator-cfg.yaml       é€‚é…å™¨é…ç½®
  â”” template.yaml           å±æ€§ä¸é€‚é…å™¨è¾“å…¥æ¨¡æ¿    #copy istio/mixer/template/authorization/template.yaml
auth.go                     é€‚é…å™¨æœåŠ¡å®ç°
Dockerfile                  Dockeré•œåƒ
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;æœ‰3å¤„ä¸é€‚é…å™¨å®ç°ç›¸å…³ï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å¯åŠ¨é…ç½®&lt;code&gt;config/config.proto&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨æœåŠ¡å®ç°&lt;code&gt;auth.go&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é€‚é…å™¨å…¥å£&lt;code&gt;cmd/main.go&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
&lt;p&gt;æ¥ä¸‹æ¥ä½¿ç”¨&lt;a href=&#34;https://github.com/hb-go/micro-mesh/tree/master/examples/adapter/auth&#34;&gt;micro-mesh/examples/adapter/auth&lt;/a&gt;æºç æŒ‰æ­¥éª¤æ“ä½œï¼Œå®ç°æœ¬åœ°åŠ&lt;code&gt;K8S&lt;/code&gt;ç¯å¢ƒçš„æµ‹è¯•éƒ¨ç½²&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;æ­¥éª¤&#34;&gt;æ­¥éª¤&lt;/h2&gt;

&lt;p&gt;å¼€å‘ç¯å¢ƒ&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;OSX&lt;/p&gt;

&lt;p&gt;Go &lt;strong&gt;1.11.1&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;protoc &lt;strong&gt;libprotoc 3.6.1&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Istio &lt;strong&gt;1.0.6&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&#34;1-istioæºç &#34;&gt;1.Istioæºç &lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;mkdir -p $GOPATH/src/istio.io/
cd $GOPATH/src/istio.io/
git clone https://github.com/istio/istio.git
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;2-micro-meshæºç &#34;&gt;2.micro-meshæºç &lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;git clone https://github.com/hb-go/micro-mesh.git
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;3-mixerå¼€å‘å·¥å…·&#34;&gt;3.Mixerå¼€å‘å·¥å…·&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# build mixer server &amp;amp; client 
cd istio
make mixs
make mixc
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;åœ¨&lt;code&gt;$GOPATH/out/darwin_amd64/release/&lt;/code&gt;ç”Ÿæˆ&lt;code&gt;mixs&lt;/code&gt;ã€&lt;code&gt;mixc&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&#34;4-æ„å»ºauth-adapteré¡¹ç›®-optional&#34;&gt;4.æ„å»ºAuth adapteré¡¹ç›®(optional)&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# copy auth adapter example
cp {micro-mesh path}/examples/adapter/auth mixer/adapter/auth

cd mixer/adapter/auth

# å¯ä»¥åˆ é™¤`config`ç›®å½•é™¤`config.proto`å¤–çš„å…¶ä»–æ–‡ä»¶ï¼Œçœ‹æ‰§è¡Œgo generateåçš„ç»“æœ
go generate ./...
go build ./...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;code&gt;go generate&lt;/code&gt;æ ¹æ®&lt;code&gt;config/config.proto&lt;/code&gt;ä»¥åŠ&lt;code&gt;auth.go&lt;/code&gt;çš„æ³¨é‡Šè‡ªåŠ¨ç”Ÿæˆ&lt;code&gt;config&lt;/code&gt;ç›®å½•ä¸‹çš„å…¶ä»–æ–‡ä»¶:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;config.pb.go&lt;/li&gt;
&lt;li&gt;config.proto_descriptor&lt;/li&gt;
&lt;li&gt;auth-adapter.yaml&lt;/li&gt;
&lt;li&gt;adapter.auth.config.pb.html&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;æ ¹æ®&lt;code&gt;auth.go&lt;/code&gt;çš„ä»¥ä¸‹æ³¨é‡Šï¼Œ&lt;code&gt;mixer_codegen.sh&lt;/code&gt;ä½¿ç”¨&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿ç”Ÿæˆ&lt;code&gt;name&lt;/code&gt;ä¸º&lt;code&gt;auth-adapter&lt;/code&gt;çš„é€‚é…å™¨&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;// nolint:lll
// Generates the auth adapter&#39;s resource yaml. It contains the adapter&#39;s configuration, name, supported template
// names (metric in this case), and whether it is session or no-session based.
//go:generate $GOPATH/src/istio.io/istio/bin/mixer_codegen.sh -a mixer/adapter/auth/config/config.proto -x &amp;quot;-s=false -n auth-adapter -t authorization&amp;quot;
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;5-æœ¬åœ°æµ‹è¯•&#34;&gt;5.æœ¬åœ°æµ‹è¯•&lt;/h3&gt;

&lt;p&gt;æœ¬åœ°æµ‹è¯•ä½¿ç”¨testdataä¸‹çš„é…ç½®ï¼Œå…¶ä¸­&lt;code&gt;operator-cfg.yaml&lt;/code&gt;æœ‰å‡ å¤„ä¸æ­£å¼éƒ¨ç½²ä¸åŒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt;çš„&lt;code&gt;address&lt;/code&gt;ä½¿ç”¨æœ¬åœ°æœåŠ¡&lt;code&gt;&amp;quot;[::]:44225&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä¸ºäº†æ–¹ä¾¿æµ‹è¯•&lt;code&gt;instance&lt;/code&gt;çš„&lt;code&gt;params&lt;/code&gt;å‚æ•°ä»¥åŠ&lt;code&gt;rule&lt;/code&gt;çš„&lt;code&gt;math&lt;/code&gt;æ¡ä»¶åšäº†ç®€åŒ–&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# å¯åŠ¨é€‚é…å™¨æœåŠ¡
go run cmd/main.go 44225

# ä½¿ç”¨testdataä¸‹é…ç½®å¯åŠ¨mixer server
$GOPATH/out/darwin_amd64/release/mixs server \
--configStoreURL=fs://$GOPATH/src/istio.io/istio/mixer/adapter/auth/testdata \
--log_output_level=attributes:debug

# æµ‹è¯•Adapteræ˜¯å¦ç”Ÿæ•ˆ
$GOPATH/out/darwin_amd64/release/mixc check -s request.host=&amp;quot;localhost&amp;quot; --stringmap_attributes &amp;quot;request.headers=x-custom-token:efg&amp;quot;
# Check RPC completed successfully. Check status was PERMISSION_DENIED (mm-example-auth.handler.istio-system:Unauthorized...)

$GOPATH/out/darwin_amd64/release/mixc check -s request.host=&amp;quot;localhost&amp;quot; --stringmap_attributes &amp;quot;request.headers=x-custom-token:abc&amp;quot;
# Check RPC completed successfully. Check status was OK
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;6-æ‰“åŒ…é•œåƒ&#34;&gt;6.æ‰“åŒ…é•œåƒ&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# buildæ‰§è¡Œæ–‡ä»¶
CGO_ENABLED=0 GOOS=linux \
    go build -a -installsuffix cgo -v -o bin/auth ./cmd/
    
# dockeré•œåƒ
docker build -t hbchen/micro-mesh-example-adapter-auth:v0.0.1 .
docker push hbchen/micro-mesh-example-adapter-auth:v0.0.1
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;7-istioç¯å¢ƒéƒ¨ç½²&#34;&gt;7.Istioç¯å¢ƒéƒ¨ç½²&lt;/h3&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# å±æ€§ã€æ¨¡æ¿
# attributes.yaml -&amp;gt; istio/mixer/testdata/config/attributes.yaml 
# template.yaml -&amp;gt; istio/mixer/template/authorization/template.yaml
kubectl apply -f examples/adapter/auth/testdata/attributes.yaml -f examples/adapter/auth/testdata/template.yaml

# é€‚é…å™¨
kubectl apply -f examples/adapter/auth/config/auth-adapter.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
&lt;p&gt;è¿™é‡Œæ˜¯ä»¥&lt;a href=&#34;https://github.com/hb-go/micro-mesh&#34;&gt;micro-mesh&lt;/a&gt;ç¤ºä¾‹ä¸ºåŸºç¡€çš„é…ç½®ï¼Œå¦‚æœä½¿ç”¨&lt;code&gt;bookinfo&lt;/code&gt;æˆ–è€…è‡ªå·±çš„æœåŠ¡éœ€è¦åšç›¸åº”çš„ä¿®æ”¹&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;code&gt;operator-cfg.yaml&lt;/code&gt;ä¸æœ¬åœ°æµ‹è¯•é…ç½®ä¸åŒï¼š&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;handler&lt;/code&gt;çš„&lt;code&gt;address&lt;/code&gt;ä½¿ç”¨é›†ç¾¤æœåŠ¡&lt;code&gt;&amp;quot;mm-example-auth-adapter-service:44225&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code&gt;instance&lt;/code&gt;çš„&lt;code&gt;params&lt;/code&gt;æ ¹æ®&lt;code&gt;authorization&lt;/code&gt;æ¨¡æ¿åŠ&lt;code&gt;auth-adapter&lt;/code&gt;æœåŠ¡çš„éœ€æ±‚é…ç½®&lt;/li&gt;
&lt;li&gt;&lt;code&gt;rule&lt;/code&gt;çš„&lt;code&gt;match&lt;/code&gt;æ¡ä»¶ä½¿ç”¨&lt;code&gt;destination.service == &amp;quot;mm-example-api.default.svc.cluster.local&amp;quot;&lt;/code&gt;ï¼Œä»…å¯¹&lt;code&gt;mm-example-api&lt;/code&gt;æœåŠ¡ç”Ÿæ•ˆ&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;# é€‚é…å™¨æœåŠ¡å®ä¾‹éƒ¨ç½²
kubectl apply -f examples/adapter/auth/operatorconfig/cluser-service.yaml

# é€‚é…å™¨é…ç½®
kubectl apply -f examples/adapter/auth/operatorconfig/operator-cfg.yaml
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;8-istioç¯å¢ƒéƒ¨ç½²æµ‹è¯•&#34;&gt;8.Istioç¯å¢ƒéƒ¨ç½²æµ‹è¯•&lt;/h3&gt;

&lt;blockquote&gt;
&lt;p&gt;å¦‚æœæ²¡æœ‰å¼€Gatewayçš„JWTéªŒè¯å¯ä»¥å¿½ç•¥&lt;code&gt;Authorization&lt;/code&gt;ï¼Œå…¶å®åšäº†è‡ªå®šä¹‰Authåæ˜¯å¤šä½™çš„ğŸ˜‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;TOKEN=$(curl https://raw.githubusercontent.com/istio/istio/release-1.1/security/tools/jwt/samples/demo.jwt -s)

curl -H &amp;quot;Authorization: Bearer $TOKEN&amp;quot; -H &amp;quot;x-custom-token: efg&amp;quot; -X GET http://35.193.180.18/v1/example/call/Hobo
curl -H &amp;quot;Authorization: Bearer $TOKEN&amp;quot; -H &amp;quot;x-custom-token: abc&amp;quot; -X GET http://35.193.180.18/v1/example/call/Hobo

&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;å‚è€ƒ&#34;&gt;å‚è€ƒ&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/istio/istio/wiki/Mixer-Out-of-Process-Adapter-Walkthrough&#34;&gt;Mixer Out of Process Adapter Walkthrough&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://medium.com/google-cloud/simple-istio-mixer-out-of-process-authorization-adapter-5f9363cd9bbc&#34;&gt;Simple Istio Mixer Out of Process Authorization Adapter&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</description>
      
    </item>
    
    <item>
      <title>go-microåŠ å…¥IstioæœåŠ¡ç½‘æ ¼</title>
      <link>http://hbchen.com/post/2019-01-08-go-micro%E5%8A%A0%E5%85%A5istio%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/</link>
      <pubDate>Thu, 21 Feb 2019 16:59:37 +0800</pubDate>
      
      <guid>http://hbchen.com/post/2019-01-08-go-micro%E5%8A%A0%E5%85%A5istio%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/</guid>
      
        <description>&lt;p&gt;å°†go-microæœåŠ¡åŠ å…¥service meshï¼ŒClientã€Serverä¸éœ€è¦Registryã€Selectorã€Transportç­‰ï¼Œé€šè¿‡è‡ªå®šä¹‰microçš„server &amp;amp; clientæ’ä»¶ï¼Œå»æ‰åœ¨istioä¸­ä¸éœ€è¦çš„ç»„ä»¶ä¾èµ–ã€‚&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://hbchen.com/img/go-micro-istio.jpg&#34; alt=&#34;go-micro&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/hb-go/micro-plugins&#34;&gt;hb-go/micro-plugins&lt;/a&gt;å®ç°äº†gRPCã€httpçš„Istioç‰ˆæœ¬Pluginï¼Œä¸‹é¢ä»‹ç»å¦‚ä½•ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å®Œæ•´ç¤ºä¾‹å‚è€ƒ&lt;a href=&#34;https://github.com/hb-go/micro/tree/master/istio&#34;&gt;hb-go/micro/istio&lt;/a&gt;ï¼Œç¤ºä¾‹åŒ…æ‹¬httpã€gRPC&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h5 id=&#34;å‘½ä»¤è¡Œå‚æ•°&#34;&gt;å‘½ä»¤è¡Œå‚æ•°&lt;/h5&gt;

&lt;p&gt;æ–¹ä¾¿æœåŠ¡è¿è¡Œæ—¶æŒ‡å®šç«¯å£ï¼Œåœ¨å‘½ä»¤è¡Œè·å–æœåŠ¡serverã€clientç«¯å£é…ç½®ï¼Œå‚æ•°æ ¹æ®å…·ä½“æƒ…å†µè‡ªè¡Œè®¾è®¡&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;åœ¨æœåŠ¡ç½‘æ ¼ä¸­æˆ‘å€¾å‘ç»Ÿä¸€ä¸Šä¸‹æ¸¸æœåŠ¡ç«¯å£ï¼Œé¿å…ä¸å¿…è¦çš„é…ç½®ä»¥åŠå› æ­¤å¼•å‘çš„å†²çªé—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
&lt;li&gt;Clientç«¯æœåŠ¡åœ°å€&lt;code&gt;CallOptions.Address&lt;/code&gt;è§£æè§„åˆ™ï¼š

&lt;ul&gt;
&lt;li&gt;&lt;code&gt;:&lt;/code&gt;å¼€å¤´ï¼Œå°†&lt;code&gt;service.Name&lt;/code&gt;ä¸­&lt;code&gt;.&lt;/code&gt;æ›¿æ¢ä¸º&lt;code&gt;-&lt;/code&gt;ï¼ŒåŠ &lt;code&gt;CallOptions.Address&lt;/code&gt;ï¼Œå¦‚&lt;code&gt;go.micro.api.sample&lt;/code&gt; &lt;code&gt;:9080&lt;/code&gt; =&amp;gt; &lt;code&gt;go-micro-api-sample:9080&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;é&lt;code&gt;:&lt;/code&gt;å¼€å¤´ï¼Œå›ºå®šåœ°å€&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;var (
	serverAddr string
	callAddr   string
	cmdHelp    bool
)

func init() {
	flag.StringVar(&amp;amp;serverAddr, &amp;quot;server_address&amp;quot;, &amp;quot;0.0.0.0:9080&amp;quot;, &amp;quot;server address.&amp;quot;)
	flag.StringVar(&amp;amp;callAddr, &amp;quot;client_call_address&amp;quot;, &amp;quot;:9080&amp;quot;, &amp;quot;client call options address.&amp;quot;)
	flag.Parse()
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&#34;è‡ªå®šä¹‰server-clientæ’ä»¶-åˆ›å»ºæœåŠ¡&#34;&gt;è‡ªå®šä¹‰serverã€clientæ’ä»¶ï¼Œåˆ›å»ºæœåŠ¡&lt;/h5&gt;

&lt;blockquote&gt;
&lt;p&gt;ç”±äºmicroæ¡†æ¶å¯¹å‘½ä»¤è¡Œçš„è§£æé—®é¢˜ï¼Œåˆ›å»ºæœåŠ¡æ—¶éœ€è¦å¢åŠ &lt;code&gt;micro.Flags(...)&lt;/code&gt;ï¼Œå…¼å®¹è‡ªå®šä¹‰å‚æ•°ï¼Œå¦‚:&lt;code&gt;client_call_address&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-go&#34;&gt;import (
	httpClient &amp;quot;github.com/hb-go/micro-plugins/client/istio_http&amp;quot;
	httpServer &amp;quot;github.com/hb-go/micro-plugins/server/istio_http&amp;quot;
)

func main() {
	c := httpClient.NewClient(
		client.ContentType(&amp;quot;application/json&amp;quot;),
		func(o *client.Options) {
			o.CallOptions.Address = callAddr
		},
	)
	s := httpServer.NewApiServer(
		server.Address(serverAddr),
	)

	// New Service
	service := micro.NewService(
		micro.Name(&amp;quot;go.micro.api.sample&amp;quot;),
		micro.Version(&amp;quot;latest&amp;quot;),
		micro.Registry(noop.NewRegistry()),
		micro.Client(c),
		micro.Server(s),

		// å…¼å®¹micro cmd parse
		micro.Flags(cli.StringFlag{
			Name:   &amp;quot;client_call_address&amp;quot;,
			EnvVar: &amp;quot;MICRO_CLIENT_CALL_ADDRESS&amp;quot;,
			Usage:  &amp;quot; Invalid!!!&amp;quot;,
		}),
	)

	service.Options().Cmd.Init()
	
	// â€¦â€¦
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h5 id=&#34;æœåŠ¡éƒ¨ç½²-yaml&#34;&gt;æœåŠ¡éƒ¨ç½².yaml&lt;/h5&gt;

&lt;blockquote&gt;
&lt;p&gt;å…¶å®ƒIstioç›¸å…³.yamlå‚è€ƒå®Œæ•´ç¤ºä¾‹&lt;a href=&#34;https://github.com/hb-go/micro/tree/master/istio/k8s&#34;&gt;hb-go/micro/istio/k8s&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;######################################################################################
# API service
######################################################################################
apiVersion: v1
kind: Service
metadata:
  name: go-micro-api-sample
  labels:
    app: go-micro-api-sample
spec:
  ports:
  - port: 9080
    name: http
  selector:
    app: go-micro-api-sample
---
apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: go-micro-api-sample-v1
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: go-micro-api-sample
        version: v1
    spec:
      containers:
      - name: go-micro-api-sample
        command: [
          &amp;quot;/sample&amp;quot;,
          &amp;quot;-server_address=0.0.0.0:9080&amp;quot;,
          &amp;quot;-client_call_address=:9080&amp;quot;,
        ]
        image: hbchen/go-micro-istio-api-sample:v0.0.5
        imagePullPolicy: IfNotPresent
        ports:
        - containerPort: 9080
---
&lt;/code&gt;&lt;/pre&gt;</description>
      
    </item>
    
    <item>
      <title>go-microæ¡†æ¶ä»‹ç»</title>
      <link>http://hbchen.com/post/2018-03-27-go-micro-%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D/</link>
      <pubDate>Tue, 27 Mar 2018 19:09:32 +0800</pubDate>
      
      <guid>http://hbchen.com/post/2018-03-27-go-micro-%E6%A1%86%E6%9E%B6%E4%BB%8B%E7%BB%8D/</guid>
      
        <description>&lt;h2 id=&#34;go-micro-https-github-com-micro-go-micro&#34;&gt;&lt;a href=&#34;https://github.com/micro/go-micro&#34;&gt;go-micro&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;go-microæ˜¯Microçš„æ ¸å¿ƒï¼Œæ˜¯ä¸€å¥—Goè¯­è¨€çš„å¯æ’æ‹”RPCæ¡†æ¶ï¼Œæä¾›æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€åŒæ­¥/å¼‚æ­¥é€šä¿¡ã€ç¼–ç ã€æœåŠ¡æ¥å£ç­‰ï¼Œæ‰€æœ‰ç»„ä»¶å‡è®¾è®¡ä¸ºInterfaceï¼Œä¾¿äºæ‰©å±•&lt;/p&gt;

&lt;p&gt;&lt;img src=&#34;http://hbchen.com/img/go-micro.jpg&#34; alt=&#34;go-micro&#34; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;/p&gt;

&lt;p&gt;ä¸»è¦æœ‰ä»¥ä¸‹ç»„ä»¶æ„æˆ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Registry&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æä¾›ä¸€å¥—æœåŠ¡æ³¨å†Œã€å‘ç°ã€æ³¨é”€ã€ç›‘æµ‹æœºåˆ¶ï¼ŒæœåŠ¡æ³¨å†Œä¸­å¿ƒæ”¯æŒconsulã€etcd2/3ã€zookeeperã€gossipã€k8sã€eurekaç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Selector&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é€‰æ‹©å™¨æä¾›äº†è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é€šè¿‡è¿‡æ»¤æ–¹æ³•å¯¹å¾®æœåŠ¡è¿›è¡Œè¿‡æ»¤ï¼Œå¹¶é€šè¿‡ä¸åŒè·¯ç”±ç®—æ³•é€‰æ‹©å¾®æœåŠ¡ï¼Œä»¥åŠç¼“å­˜ç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Transport&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¾®æœåŠ¡é—´åŒæ­¥è¯·æ±‚/å“åº”é€šä¿¡æ–¹å¼ï¼Œç›¸å¯¹Goæ ‡å‡†netåŒ…åšäº†æ›´é«˜çš„æŠ½è±¡ï¼Œæ”¯æŒæ›´å¤šçš„ä¼ è¾“æ–¹å¼ï¼Œå¦‚httpã€grpcã€tcpã€udpã€Rabbitmqç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Broker&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;å¾®æœåŠ¡é—´å¼‚æ­¥å‘å¸ƒ/è®¢é˜…é€šä¿¡æ–¹å¼ï¼Œæ›´å¥½çš„å¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿè§£è€¦é—®é¢˜ï¼Œé»˜è®¤ä½¿ç”¨httpæ–¹å¼ï¼Œç”Ÿäº§ç¯å¢ƒé€šå¸¸ä¼šä½¿ç”¨æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¦‚Kafkaã€RabbitMQã€NSQç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Codec&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æœåŠ¡é—´æ¶ˆæ¯çš„ç¼–è§£ç ï¼Œæ”¯æŒjsonã€protobufã€bsonã€msgpackç­‰ï¼Œä¸æ™®é€šç¼–ç æ ¼å¼ä¸åŒéƒ½æ˜¯æ”¯æŒRPCæ ¼å¼&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Server&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ç”¨äºå¯åŠ¨æœåŠ¡ï¼Œä¸ºæœåŠ¡å‘½åã€æ³¨å†ŒHandlerã€æ·»åŠ ä¸­é—´ä»¶ç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Client&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æä¾›å¾®æœåŠ¡å®¢æˆ·ç«¯ï¼Œé€šè¿‡Registryã€Selectorã€Transportã€Brokerå®ç°ä»¥æœåŠ¡åæ¥æŸ¥æ‰¾æœåŠ¡ã€è´Ÿè½½å‡è¡¡ã€åŒæ­¥é€šä¿¡ã€å¼‚æ­¥æ¶ˆæ¯ç­‰&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;micro-https-github-com-micro-micro&#34;&gt;&lt;a href=&#34;https://github.com/micro/micro&#34;&gt;micro&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;Microçš„å·¥å…·åŒ…ï¼Œä¸»è¦ç”±ä»¥ä¸‹éƒ¨åˆ†æ„æˆ:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;API&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;APIç½‘å…³æä¾›HTTPæœåŠ¡ï¼Œå¹¶å°†è¯·æ±‚è·¯ç”±åˆ°æŒ‡å®šçš„å¾®æœåŠ¡ï¼Œæ˜¯Microçš„ç»Ÿä¸€å…¥å£ï¼Œå¯ä»¥ç”¨ä½œåå‘ä»£ç†ï¼Œæˆ–è€…å°†HTTPè¯·æ±‚è½¬åˆ°RPC&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Web&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;ä¸ºMicroæä¾›ä¸€å¥—ä»ªè¡¨ç›˜ï¼Œå¹¶å¯ä½œä¸ºWebåº”ç”¨çš„åå‘ä»£ç†ï¼Œæœ‰åˆ«äºæ™®é€šAPIå°†Webåº”ç”¨ä½œä¸ºäº†Microçš„ä¸€ç­‰å…¬æ°‘ï¼Œå…¶å®å’ŒAPIå·®ä¸å¤šï¼Œä½†åŒæ—¶æä¾›äº†å¯¹socketçš„æ”¯æŒ&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Sidecar&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡HTTPçš„æ–¹å¼å®ç°go-microå…¨éƒ¨åŠŸèƒ½çš„RPCä»£ç†ï¼Œé€šè¿‡Sidecarå¯ä»¥æ–¹ä¾¿çš„å°†å…¶ä»–è¯­è¨€é›†æˆåˆ°Microæ¡†æ¶ä¸­ï¼Œæ–¹ä¾¿è§£å†³è§£å†³åº”ç”¨çš„å¼‚æ„æ¡†æ¶é—®é¢˜&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;CLI&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;æä¾›ä¸€å¥—å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥æ–¹ä¾¿çš„ä¸MicroæœåŠ¡è¿›è¡Œäº¤äº’ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Sidecarä»£ç†CLIå‘½ä»¤&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;Bot&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;é€šè¿‡Botå¯ä»¥åœ¨Microç¯å¢ƒä¸­æ–¹ä¾¿çš„ä¸Slackã€HipChatã€XMPPç­‰è¿›è¡Œé›†æˆï¼Œé€šè¿‡æ¶ˆæ¯çš„æ–¹å¼æ¨¡ä»¿CLIåŠŸèƒ½&lt;/p&gt;
&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;go-plugins-https-github-com-micro-go-plugins&#34;&gt;&lt;a href=&#34;https://github.com/micro/go-plugins&#34;&gt;go-plugins&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;go-pluginsæ˜¯Microçš„æ’ä»¶åº“ï¼Œé™¤go-microç›¸åº”ç»„ä»¶çš„æ‰©å±•å¤–ï¼Œè¿˜æœ‰å…¶ä»–å¦‚Traceã€KVå­˜å‚¨ã€ç›‘æ§ç­‰&lt;/p&gt;</description>
      
    </item>
    
  </channel>
</rss>